# 环境变量配置示例

创建 `.env` 文件在项目根目录，配置以下环境变量：

## 完整配置模板

```bash
# Flask配置
FLASK_ENV=development
SECRET_KEY=your-secret-key-change-this-in-production
PORT=5000

# 数据库配置（SQLite，自动创建）
DATABASE_URL=sqlite:///instance/database.db

# CORS配置（多个源用逗号分隔，或使用 * 允许所有）
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# ============================================
# AI服务配置
# ============================================

# AI服务提供商格式选择
# 可选值: gemini (Google GenAI SDK) 或 openai (OpenAI SDK)
# ⚠️ 注意：变量名是 AI_PROVIDER_FORMAT，不是 AI_PROVIDER
AI_PROVIDER_FORMAT=gemini

# --------------------------------------------
# Google Gemini 配置
# --------------------------------------------
GOOGLE_API_KEY=
GOOGLE_API_BASE=

# --------------------------------------------
# OpenAI 配置
# --------------------------------------------
OPENAI_API_KEY=
OPENAI_API_BASE=https://api.openai.com/v1

# ============================================
# 文件解析服务配置（MinerU）
# ============================================
MINERU_TOKEN=
MINERU_API_BASE=https://mineru.net

# ============================================
# 其他配置
# ============================================

# 图片识别模型
IMAGE_CAPTION_MODEL=gemini-2.5-flash

# 并发配置
MAX_DESCRIPTION_WORKERS=5
MAX_IMAGE_WORKERS=8

# 图片生成默认配置
DEFAULT_ASPECT_RATIO=16:9
DEFAULT_RESOLUTION=2K

# 日志级别 (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO
```

## 快速配置示例

### 使用 Google Gemini

```bash
AI_PROVIDER_FORMAT=gemini
GOOGLE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### 使用 OpenAI

```bash
AI_PROVIDER_FORMAT=openai
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
OPENAI_API_BASE=https://api.openai.com/v1
```

### 使用 OpenAI 兼容的第三方服务

```bash
AI_PROVIDER_FORMAT=openai
OPENAI_API_KEY=your_api_key_here
OPENAI_API_BASE=https://your-custom-endpoint.com/v1
```

### 使用 Antigravity2API（本地服务）

```bash
# AI Provider 格式（必须设置为 openai）
AI_PROVIDER_FORMAT=openai

# Antigravity2API 配置
# ✅ 注意：API Base URL 可以带或不带 /v1 后缀，系统会自动处理
# 方式1：不带 /v1（推荐，系统会自动添加）
OPENAI_API_BASE=http://localhost:8045
# 方式2：带 /v1（也可以，系统会保持不变）
# OPENAI_API_BASE=http://localhost:8045/v1

OPENAI_API_KEY=sk-text  # 或你的实际 API Key

# 模型配置（根据 Antigravity2API 支持的模型调整）
TEXT_MODEL=gemini-2.0-flash-exp  # 或 gemini-2.5-flash
IMAGE_MODEL=gemimi-3.0-pro-image  # 注意拼写，根据 API 文档使用
```

## 配置说明

| 变量名 | 必需 | 说明 | 默认值 |
|--------|------|------|--------|
| `AI_PROVIDER_FORMAT` | 是 | AI服务提供商格式：`gemini` 或 `openai` | `gemini` |
| `GOOGLE_API_KEY` | 条件* | Google Gemini API密钥（当 `AI_PROVIDER_FORMAT=gemini` 时必需） | - |
| `GOOGLE_API_BASE` | 否 | 自定义Gemini API端点 | - |
| `OPENAI_API_KEY` | 条件* | OpenAI API密钥（当 `AI_PROVIDER_FORMAT=openai` 时必需） | - |
| `OPENAI_API_BASE` | 否 | 自定义OpenAI API端点，**可带或不带 `/v1` 后缀**（系统会自动处理） | `https://aihubmix.com/v1` |
| `TEXT_MODEL` | 否 | 文本生成模型名称 | `gemini-2.5-flash` |
| `IMAGE_MODEL` | 否 | 图片生成模型名称 | `gemini-3-pro-image-preview` |

\* 根据 `AI_PROVIDER_FORMAT` 的值，对应的 API Key 为必需项

**重要提示**：
- ✅ **API Base URL 自动处理**：系统会自动检测并添加 `/v1` 后缀，支持以下两种配置方式：
  - `http://localhost:8045` → 自动变为 `http://localhost:8045/v1`
  - `http://localhost:8045/v1` → 保持不变
- ✅ **向后兼容**：所有修改都保持向后兼容，不影响现有配置
- ⚠️ 模型名称需要根据实际 API 服务支持的模型进行调整
- ✅ **文本生成**：优先使用流式，失败时自动降级到非流式（兼容所有服务）
- ✅ **图片生成**：先尝试带 `modalities` 参数，失败时自动降级到标准 API（兼容所有服务）

